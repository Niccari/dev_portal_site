!function(){"use strict";var e={240:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const o=r(544),i=r(887),n=r(95),s=r(59),a=r(800),l=r(331),c=r(94),u=r(621),h=r(266),d=r(387);t.default=class{constructor(){const e=new a.default,t=new s.default(e),r=new l.default,f=new o.default(i.ColorPattern.Heat);(new u.default).addFileHandler((e=>{this.controller.startVisualization(e)}));const m=new h.default(f),g=new d.default(f),w=new c.default(m,g);this.controller=new n.default(r,w,t)}}},544:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});const o=r(887);t.default=class{constructor(e){this.colorTable=[],this.resolution=128,this.toPosition=e=>e/(this.resolution-1),this.toIndex=e=>e*(this.resolution-1),this.gradientHeat=[{position:0,red:0,green:0,blue:0},{position:.25,red:0,green:0,blue:255},{position:.5,red:255,green:0,blue:0},{position:.75,red:255,green:255,blue:0},{position:1,red:255,green:255,blue:255}],this.colorToHex=e=>{const t=Math.round(e).toString(16);return 1===t.length?`0${t}`:t};const t=(()=>(o.ColorPattern.Heat,this.gradientHeat))();let r=1,i=t[0],n=t[1];for(let e=0;e<this.resolution;e+=1){const o=this.toPosition(e),s=(o-i.position)/(n.position-i.position),a=i.red+s*(n.red-i.red),l=i.green+s*(n.green-i.green),c=i.blue+s*(n.blue-i.blue);this.colorTable.push({position:o,red:a,green:l,blue:c}),n.position<=o&&(i=n,r+=1,n=t[r])}}getColor(e){if(e<0||e>1)throw new Error("position must be in 0 <= position <= 1");const t=this.toIndex(e),r=Math.floor(t),o=Math.min(r+1,this.resolution-1),i=1-(t-r),n=1-i,s=this.colorTable[r],a=this.colorTable[o],l={red:i*s.red+n*a.red,green:i*s.green+n*a.green,blue:i*s.blue+n*a.blue};return`#${this.colorToHex(l.red)}${this.colorToHex(l.green)}${this.colorToHex(l.blue)}`}}},887:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ColorPattern=void 0,t.ColorPattern={Heat:"Heat"}},95:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,r){this.intervalId=void 0,this.thermalDistributionProvider=e,this.presenter=t,this.csvLoader=r}async startVisualization(e){const t=await this.csvLoader.load(e);await this.thermalDistributionProvider.load(t),this.intervalId&&clearInterval(this.intervalId);let r=0;const o=this.thermalDistributionProvider.getAll(),i=Math.min(...o.frames.flatMap((e=>e.cells))),n=Math.max(...o.frames.flatMap((e=>e.cells)));this.intervalId=setInterval((()=>{const e=this.thermalDistributionProvider.getNumRows();this.presenter.notifyDataChange(r,e,o,i,n),r+=1,r>=o.frames.length&&(r=0)}),250)}}},59:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.fileLoader=e}async load(e){const t=await this.fileLoader.loadAsync(e,"text/csv");if("string"!=typeof t)return Promise.reject(new Error("Unsupported return type"));try{return this.parse(t)}catch(e){return Promise.reject(new Error("Cannot parse the file"))}}parse(e){return e.split("\n").slice(0,-1).map((e=>e.split(",").slice(0,-1)))}}},800:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{loadAsync(e,t){return e.type!==t?Promise.reject(new Error("Invalid file type")):new Promise(((t,r)=>{const o=new FileReader;o.onload=e=>{var o;const i=null===(o=e.target)||void 0===o?void 0:o.result;i?t(i):r()},o.readAsBinaryString(e)}))}}},331:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.thermalDistribution={numRows:0,frames:[]}}setThermalDistribution(e){this.thermalDistribution.numRows=e.numRows,this.thermalDistribution.frames=e.frames}getThermalDistribution(){if(0===this.thermalDistribution.frames.length)throw new Error("No thermal distribution loaded.");return this.thermalDistribution}getByFrame(e){return this.getThermalDistribution().frames[e]}getNumRows(){return this.getThermalDistribution().numRows}getAll(){return this.getThermalDistribution()}getAmbientCelciusAll(){return this.getThermalDistribution().frames.map((e=>e.ambientCelcius))}parseCustomDate(e){const t=e.split("-"),r=parseInt(t[0],10),o=parseInt(t[1],10)-1,i=parseInt(t[2],10),n=parseInt(t[3],10),s=parseInt(t[4],10),a=parseInt(t[5],10);return new Date(r,o,i,n,s,a)}async load(e){const t=e[0],r=["Date","Room"],o=t.length-3;if(16!==o&&64!==o)return Promise.reject(new Error(`The number of cells should be equal to 16 or 64. actual:${o}`));for(let e=0;e<o;e+=1)r.push(`P[${e}]`);const i=r.map((e=>t.findIndex((t=>t===e)))),n=Math.round(Math.sqrt(o)),s=e.slice(1).map((e=>{const t=i.slice(2).map((t=>parseFloat(e[t])));return{date:this.parseCustomDate(e[i[0]]),ambientCelcius:10*parseFloat(e[i[1]]),cells:t}}));return this.setThermalDistribution({numRows:n,frames:s}),Promise.resolve()}}},94:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.thermalDistributionView=e,this.thermalTimeFlowView=t}notifyDataChange(e,t,r,o,i){const n=r.frames[e];this.thermalDistributionView.draw(e,n,t,o,i),this.thermalTimeFlowView.drawTimeFlow(r,t,o,i),this.thermalTimeFlowView.drawCurrentFrame(e,t,r.frames.length)}}},621:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{addFileHandler(e){this.addFileEvent("inputCsv",(t=>{e(t)}));const t="sample.csv";fetch(t).then((e=>e.blob())).then((r=>{const o=new File([r],t,{type:"text/csv"});e(o)}))}addFileEvent(e,t){const r=document.getElementById(e);if(!r)return;const o=e=>{var r;const o=null===(r=e.target)||void 0===r?void 0:r.files;o&&t(o[0])};r.addEventListener("change",o),r.addEventListener("dragstart",o)}}},266:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.colorGenerator=e}getCanvas(){const e=document.getElementById("thermalDistribution");if(!e)throw new Error("Cannot acquire canvas");return e}getCanvasInfo(){const e=this.getCanvas(),t=e.getContext("2d");if(!t)throw new Error("Cannot acquire context");return{context:t,canvasWidth:e.width,canvasHeight:e.height}}drawText(e,t,r,o){e.font="64px bold sans-serif",e.strokeStyle="#000000",e.strokeText(t,r+4,o+4),e.fillStyle="#000000",e.fillText(t,r+4,o+4),e.strokeStyle="#FFFFFF",e.strokeText(t,r,o),e.fillStyle="#FFFFFF",e.fillText(t,r,o)}setColorPositionRange(e,t){return r=>(r-e)/(t-e)}draw(e,t,r,o,i){const{context:n,canvasWidth:s,canvasHeight:a}=this.getCanvasInfo(),l=.1,c=s*l,u=a*l,h=(s-2*s*l)/r,d=(a-2*a*l)/r,f=this.setColorPositionRange(o,i);n.fillStyle=this.colorGenerator.getColor(f(t.ambientCelcius)),n.fillRect(0,0,s,a),this.drawText(n,`#${e}, 室温${t.ambientCelcius.toFixed(1)}°C, ${t.date.toLocaleString()}`,10,80);for(let e=0;e<r;e+=1)for(let o=0;o<r;o+=1){const i=t.cells[o+e*r];n.fillStyle=this.colorGenerator.getColor(f(i)),n.fillRect(o*h+c,e*d+u,h,d),this.drawText(n,`${i.toFixed(1)}°C`,o*h+c+h/4,e*d+u+d/2)}this.drawColorBar(n,o,i,s,a,c,d)}drawColorBar(e,t,r,o,i,n,s){const a=e.createLinearGradient(n,0,o,s/3);for(let e=0;e<=4;e+=1){const t=e/4;a.addColorStop(t,this.colorGenerator.getColor(t))}e.fillStyle=a,e.fillRect(n,i-.4*s,o-2*n,s/3),this.drawText(e,t.toFixed(1),30,i-s/6),this.drawText(e,r.toFixed(1),o-5*n/6,i-s/6)}}},387:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.scanmapRasterX=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],this.colorGenerator=e}getCanvas(){const e=document.getElementById("thermalTimeFlow");if(!e)throw new Error("Cannot acquire canvas");return e}getCanvasInfo(){const e=this.getCanvas(),t=e.getContext("2d");if(!t)throw new Error("Cannot acquire context");return{context:t,canvasWidth:e.width,canvasHeight:e.height}}setColorPositionRange(e,t){return r=>(r-e)/(t-e)}measureFrameRectangleSize(e,t,r){return{width:r.canvasWidth/(e**2+1+1),height:r.canvasHeight/t}}drawTimeFlow(e,t,r,o){const i=this.getCanvasInfo(),{context:n}=i,{width:s,height:a}=this.measureFrameRectangleSize(t,e.frames.length,i),l=this.scanmapRasterX,c=this.setColorPositionRange(r,o);n.fillStyle="#000";for(let r=0;r<e.frames.length;r+=1){const o=e.frames[r];n.fillStyle=this.colorGenerator.getColor(c(o.ambientCelcius)),n.fillRect(0,r*a,s,a),n.fillStyle="#333333",n.fillRect(s,r*a,s,a);for(let e=0;e<t**2;e+=1)n.fillStyle=this.colorGenerator.getColor(c(o.cells[l[e]])),n.fillRect(s*(2+e),r*a,s,a)}}drawCurrentFrame(e,t,r){const o=this.getCanvasInfo(),{context:i}=o,{width:n,height:s}=this.measureFrameRectangleSize(t,r,o);i.fillStyle="#333",i.fillRect(n,0,n,s*r),i.fillStyle="#0F0",i.fillRect(n,e*s,n,s)}}}},t={};new(function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}(240).default)}();