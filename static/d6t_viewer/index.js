(()=>{"use strict";var e={240:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(544),i=r(887),s=r(95),n=r(59),l=r(800),a=r(331),c=r(94),h=r(621),u=r(266),d=r(387);t.default=new class{constructor(){const e=new l.FileLoader,t=new n.CsvLoader(e),r=new a.ThermalDistributionProvider(t),f=new o.default(i.ColorPattern.Heat);new h.CsvFileInput;const m=new u.default(f),g=new d.default(f),v=new c.Presenter(m,g);this.controller=new s.Controller(r,v)}}},607:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.controller=void 0;const o=r(240);t.controller=o.default.controller},544:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=r(887);t.default=class{constructor(e){this.colorTable=[],this.resolution=256,this.gradientHeat=[{position:0,red:0,green:0,blue:0},{position:1*this.resolution/4,red:0,green:0,blue:255},{position:2*this.resolution/4,red:255,green:0,blue:0},{position:3*this.resolution/4,red:255,green:255,blue:0},{position:this.resolution-1,red:255,green:255,blue:255}],this._colorToHex=e=>{const t=Math.round(e).toString(16);return 1==t.length?"0"+t:t};const t=(()=>{if(e===o.ColorPattern.Heat)return this.gradientHeat})();let r=1,i=t[0],s=t[1];for(let e=0;e<this.resolution;e++){const o=(e-i.position)/(s.position-i.position),n=i.red+o*(s.red-i.red),l=i.green+o*(s.green-i.green),a=i.blue+o*(s.blue-i.blue);this.colorTable.push({position:e,red:n,green:l,blue:a}),s.position==e&&(i=s,s=t[++r])}}getColor(e){if(e<0||e>1)throw new Error("position must be in 0 <= position <= 1");const t=e*(this.resolution-1),r=Math.floor(t),o=Math.ceil(t)!==this.colorTable.length?Math.ceil(t):0,i=t-r,s=1-i,n={red:Math.floor(i*this.colorTable[r].red+s*this.colorTable[o].red),green:Math.floor(i*this.colorTable[r].green+s*this.colorTable[o].green),blue:Math.floor(i*this.colorTable[r].blue+s*this.colorTable[o].blue)};return"#"+this._colorToHex(n.red)+this._colorToHex(n.green)+this._colorToHex(n.blue)}}},887:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorPattern=void 0,(t.ColorPattern||(t.ColorPattern={})).Heat="Heat"},95:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0,t.Controller=class{constructor(e,t){this.intervalId=void 0,this.thermalDistributionProvider=e,this.presenter=t}async startVisualization(e){await this.thermalDistributionProvider.load(e),this.intervalId&&clearInterval(this.intervalId);let t=0;const r=this.thermalDistributionProvider.getAll(),o=Math.min(...r.frames.flatMap((e=>e.cells))),i=Math.max(...r.frames.flatMap((e=>e.cells)));this.intervalId=setInterval((()=>{const e=this.thermalDistributionProvider.getNumRows();this.presenter.notifyDataChange(t,e,r,o,i),t++,t>=r.frames.length&&(t=0)}),250)}}},59:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CsvLoader=void 0,t.CsvLoader=class{constructor(e){this.fileLoader=e}async load(e){const t=await this.fileLoader.loadAsync(e,"text/csv");if("string"!=typeof t)return Promise.reject("Unsupported return type");try{return this.parse(t)}catch(e){return Promise.reject("Cannot parse the file")}}parse(e){return e.split("\n").map((e=>e.split(",")))}}},800:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileLoader=void 0,t.FileLoader=class{loadAsync(e,t){return e.type!==t?Promise.reject("Invalid file type"):new Promise(((t,r)=>{const o=new FileReader;o.onload=e=>{var o;const i=null===(o=e.target)||void 0===o?void 0:o.result;i?t(i):r()},o.readAsBinaryString(e)}))}}},331:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ThermalDistributionProvider=void 0,t.ThermalDistributionProvider=class{constructor(e){this.csvLoader=e,this.thermalDistribution={numRows:0,frames:[]}}setThermalDistribution(e){this.thermalDistribution.numRows=e.numRows,this.thermalDistribution.frames=e.frames}getThermalDistribution(){if(0===this.thermalDistribution.frames.length)throw new Error("No thermal distribution loaded.");return this.thermalDistribution}getByFrame(e){return this.getThermalDistribution().frames[e]}getNumRows(){return this.getThermalDistribution().numRows}getAll(){return this.getThermalDistribution()}getAmbientCelciusAll(){return this.getThermalDistribution().frames.map((e=>e.ambientCelcius))}parseCustomDate(e){const t=e.split("-"),r=parseInt(t[0]),o=parseInt(t[1])-1,i=parseInt(t[2]),s=parseInt(t[3]),n=parseInt(t[4]),l=parseInt(t[5]);return new Date(r,o,i,s,n,l)}async load(e){const t=await this.csvLoader.load(e),r=t[0],o=["Date","Room"],i=r.length-4;if(16!==i&&64!==i)return Promise.reject("The number of cells should be equal to 16 or 64. actual:"+i);for(let e=0;e<i;e++)o.push("P["+e+"]");const s=o.map((e=>r.findIndex((t=>t===e)))),n=Math.round(Math.sqrt(i)),l=t.slice(1,-1).map((e=>{const t=s.slice(2).map((t=>parseFloat(e[t])));return{date:this.parseCustomDate(e[s[0]]),ambientCelcius:10*parseFloat(e[s[1]]),cells:t}}));this.setThermalDistribution({numRows:n,frames:l})}}},94:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Presenter=void 0,t.Presenter=class{constructor(e,t){this.thermalDistributionView=e,this.thermalTimeFlowView=t}notifyDataChange(e,t,r,o,i){const s=r.frames[e];this.thermalDistributionView.draw(e,s,t,o,i),this.thermalTimeFlowView.drawTimeFlow(r,t,o,i),this.thermalTimeFlowView.drawCurrentFrame(e,t,r.frames.length)}}},621:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CsvFileInput=void 0;const o=r(607);t.CsvFileInput=class{constructor(){this.addFileEvent("inputCsv",(e=>{o.controller.startVisualization(e)}))}addFileEvent(e,t){const r=document.getElementById(e);if(!r)return;const o=e=>{var r;const o=null===(r=e.target)||void 0===r?void 0:r.files;o&&t(o[0])};r.addEventListener("change",o),r.addEventListener("dragstart",o)}}},266:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.colorGenerator=e}getCanvas(){const e=document.getElementById("thermalDistribution");if(!e)throw new Error("Cannot acquire canvas");return e}getCanvasInfo(){const e=this.getCanvas(),t=e.getContext("2d");if(!t)throw new Error("Cannot acquire context");return{context:t,canvasWidth:e.width,canvasHeight:e.height}}drawText(e,t,r,o){e.font="64px bold sans-serif",e.strokeStyle="#000000",e.strokeText(t,r+4,o+4),e.fillStyle="#000000",e.fillText(t,r+4,o+4),e.strokeStyle="#FFFFFF",e.strokeText(t,r,o),e.fillStyle="#FFFFFF",e.fillText(t,r,o)}setColorPositionRange(e,t){return r=>(r-e)/(t-e)}draw(e,t,r,o,i){const{context:s,canvasWidth:n,canvasHeight:l}=this.getCanvasInfo(),a=.1,c=n*a,h=l*a,u=(n-2*n*a)/r,d=(l-2*l*a)/r,f=this.setColorPositionRange(o,i);s.fillStyle=this.colorGenerator.getColor(f(t.ambientCelcius)),s.fillRect(0,0,n,l),this.drawText(s,"#"+e+", 室温"+t.ambientCelcius.toFixed(1)+"°C, "+t.date.toLocaleString(),10,80);for(let e=0;e<r;e++)for(let o=0;o<r;o++){const i=t.cells[o+e*r];s.fillStyle=this.colorGenerator.getColor(f(i)),s.fillRect(o*u+c,e*d+h,u,d),this.drawText(s,i.toFixed(1)+"°C",o*u+c+u/4,e*d+h+d/2)}this.drawColorBar(s,o,i,n,l,c,d)}drawColorBar(e,t,r,o,i,s,n){const l=e.createLinearGradient(s,0,o,n/3);for(let e=0;e<=4;e++){const t=e/4;l.addColorStop(t,this.colorGenerator.getColor(t))}e.fillStyle=l,e.fillRect(s,i-.4*n,o-2*s,n/3),this.drawText(e,t.toFixed(1),30,i-n/6),this.drawText(e,r.toFixed(1),o-5*s/6,i-n/6)}}},387:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.scanmapRasterX=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],this.colorGenerator=e}getCanvas(){const e=document.getElementById("thermalTimeFlow");if(!e)throw new Error("Cannot acquire canvas");return e}getCanvasInfo(){const e=this.getCanvas(),t=e.getContext("2d");if(!t)throw new Error("Cannot acquire context");return{context:t,canvasWidth:e.width,canvasHeight:e.height}}setColorPositionRange(e,t){return r=>(r-e)/(t-e)}measureFrameRectangleSize(e,t,r){return{width:r.canvasWidth/(e**2+1+1),height:r.canvasHeight/t}}drawTimeFlow(e,t,r,o){const i=this.getCanvasInfo(),{context:s}=i,{width:n,height:l}=this.measureFrameRectangleSize(t,e.frames.length,i),a=this.scanmapRasterX,c=this.setColorPositionRange(r,o);s.fillStyle="#000";for(let r=0;r<e.frames.length;r++){const o=e.frames[r];s.fillStyle=this.colorGenerator.getColor(c(o.ambientCelcius)),s.fillRect(0,r*l,n,l),s.fillStyle="#333333",s.fillRect(n,r*l,n,l);for(let e=0;e<t**2;e++)s.fillStyle=this.colorGenerator.getColor(c(o.cells[a[e]])),s.fillRect(n*(2+e),r*l,n,l)}}drawCurrentFrame(e,t,r){const o=this.getCanvasInfo(),{context:i}=o,{width:s,height:n}=this.measureFrameRectangleSize(t,r,o);i.fillStyle="#333",i.fillRect(s,0,s,n*r),i.fillStyle="#0F0",i.fillRect(s,e*n,s,n)}}}},t={};!function r(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,r),s.exports}(607)})();