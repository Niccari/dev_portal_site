!function(){"use strict";var e={312:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.IMAGE_UNIT_WIDTH_PX=void 0,t.IMAGE_UNIT_WIDTH_PX=40},785:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=async e=>new Promise((t=>{setTimeout((()=>{t()}),e)}))},870:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MapAttribute=void 0,t.MapAttribute={x:6,y:7}},0:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.loadMapInfoAsync=t.parseDataAsync=void 0;const o=n(313),a=(e,t,n,o)=>{const a=[];for(let r=0;r<n;r+=1){a[r]=[];for(let n=0;n<t;n+=1)a[r][n]=o(e+2*(n+r*t))}return a};t.parseDataAsync=e=>{const t=(n=e,e=>n[e]+256*n[e+1]);var n;const o=t(46),r=t(34),s=t(36);if(!((e,t,n)=>e<=501||t<=200||n<=200)(o,r,s))throw new Error("Invalid data size!");const i=90+o*o*4,d=i+60*r*2,I=((e,t,n)=>{const o=[];for(let e=0;e<t;e+=1){o[e]=[];for(let a=0;a<t;a+=1){const r=90+2*(a+e*t),s=r+t*t*2;o[e][a]={obj:n(s),bg:n(r)}}}return o})(0,o,t),l=a(i,60,r,t),c=a(d,60,s,t),_=Array.from(Array(12).keys()).map((e=>t(20+e)%256));return{check:t(0),version:t(2),hpInit:t(10),strInit:t(12),defInit:t(14),goldInit:t(16),items:_,hpMap:t(32),numBg:r,numObj:s,xInit:t(38),yInit:t(40),xGameover:t(42),yGameover:t(44),sizeMap:o,numMessage:t(48),map:I,bgAttrs:l,objAttrs:c}},t.loadMapInfoAsync=async e=>{const n=await(0,o.loadFileAsync)(e,"");if("string"!=typeof n)throw new Error("Unsupported return type");const a=(e=>{const t=[];for(let n=0;n<e.length-2;){const o=e[n];if(o===e[n+1]){const a=e[n+2]+1;t.push(...Array(a).fill(o)),n+=3}else t.push(o),n+=1}return t.push(...e.slice(e.length-2)),t})(n.split("").map((e=>e.charCodeAt(0))));return(0,t.parseDataAsync)(a)}},313:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.loadFileAsync=void 0,t.loadFileAsync=(e,t)=>e.type!==t?Promise.reject(new Error("Invalid file type")):new Promise(((n,o)=>{const a=new FileReader;a.onload=e=>{var t;const a=null===(t=e.target)||void 0===t?void 0:t.result;a?n(a):o()},t.includes("image")?a.readAsDataURL(e):a.readAsBinaryString(e)}))},107:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.loadImageUrlAsync=void 0;const o=n(313);t.loadImageUrlAsync=async e=>{const t=await(0,o.loadFileAsync)(e,"image/gif");return"string"==typeof t?t:Promise.reject(new Error("Unsupported return type"))}},459:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const o=n(312),a=n(156);t.default=class{showGifInfo(e){const{width:t,height:n}=e;return[`横方向の画像数, 縦方向の画像数 = ${Math.floor(t/o.IMAGE_UNIT_WIDTH_PX)}, ${Math.floor(n/o.IMAGE_UNIT_WIDTH_PX)}`]}showMapInfo(e){return["マップバージョン:"+e.version/10,`HP:${e.hpInit}/${e.hpMap}`,`攻撃力:${e.strInit}`,`防御力:${e.defInit}`,`所持金:${e.goldInit}`,`所持アイテム番号:${e.items.map((e=>e.toString())).join(",")}`,`MAX HP:${e.hpMap}`,`背景パーツ 最大数:${e.numBg}`,`物体パーツ 最大数:${e.numObj}`,`初期位置(x, y): (${e.xInit}, ${e.yInit})`,`ゲームオーバー位置(x, y): (${e.xGameover}, ${e.yGameover})`,`マップサイズ(w, h):${e.sizeMap}x${e.sizeMap}`]}resolveErrorMessage(e){switch(e){case a.ErrorCode.DataLoadFailed:return"マップファイルを読み込めませんでした。WWAで使用しているマップファイルかご確認ください。";case a.ErrorCode.ImageLoadFailed:return"画像ファイルを読み込めませんでした。WWAで使用している画像ファイルかご確認ください。";default:return""}}}},156:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCode=void 0,t.ErrorCode={DataLoadFailed:1,ImageLoadFailed:2}},132:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.View=t.HtmlDefines=void 0;const o=n(312),a=n(785),r=n(870),s=n(855);t.HtmlDefines={UPLOADED_ID_GIF:"gif_uploaded",UPLOADED_ID_MAP:"dat_uploaded",INPUT_ID_GIF:"gif_file",INPUT_ID_MAP:"dat_file",GIF_SRC_PREVIEW:"gif_src_preview",IS_LOADING:"is_loading",ERROR_MESSAGE:"error_message",CANVAS_GIF_MAP_PREVIEW:"gif_map_preview"};class i{constructor(){this.addEvents=(e,n)=>{i.addFileEvent(t.HtmlDefines.INPUT_ID_GIF,e),i.addFileEvent(t.HtmlDefines.INPUT_ID_MAP,n)},this.showMap=async e=>{const n=i.fetchImageTag(),a=i.getCanvasById(t.HtmlDefines.CANVAS_GIF_MAP_PREVIEW);if(!n||!a)return;const s=a.getContext("2d",{alpha:!1});if(!s)return;const{sizeMap:d}=e;a.width=d*o.IMAGE_UNIT_WIDTH_PX,a.height=d*o.IMAGE_UNIT_WIDTH_PX;const{map:I}=e;for(let t=0;t<d;t+=1)for(let a=0;a<d;a+=1){const{bg:i}=I[t][a],{obj:d}=I[t][a],l=e.bgAttrs[i],c=e.objAttrs[d];if(l&&c){const e=l[r.MapAttribute.x],i=l[r.MapAttribute.y],d=c[r.MapAttribute.x],I=c[r.MapAttribute.y];s.drawImage(n,e,i,o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX,a*o.IMAGE_UNIT_WIDTH_PX,t*o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX),0===d&&0===I||s.drawImage(n,d,I,o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX,a*o.IMAGE_UNIT_WIDTH_PX,t*o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX)}}},this.showGif=async e=>new Promise(((t,n)=>{const o=i.fetchImageTag();o?(o.onload=()=>{t({width:o.width,height:o.height,dataUrl:e})},o.src=e):n()})),this.showIfNeeded=(e,t)=>{const n=i.resolveTag(e),o=document.getElementById(n);if(!o)return;o.style.display=t?"inline-block":"none"},this.showError=async e=>{const n=document.getElementById(t.HtmlDefines.ERROR_MESSAGE);n&&(n.style.display="block",n.innerHTML=e,await(0,a.default)(3e3),n.style.display="none")}}}i.addFileEvent=(e,t)=>{const n=document.getElementById(e);if(!n)return;const o=e=>{var n;const o=null===(n=e.target)||void 0===n?void 0:n.files;o&&t(o[0])};n.addEventListener("change",o),n.addEventListener("dragstart",o)},i.fetchImageTag=()=>document.getElementById(t.HtmlDefines.GIF_SRC_PREVIEW),i.getCanvasById=e=>document.getElementById(e)||null,i.resolveTag=e=>{switch(e){case s.TagId.GIF_UPLOADED:return t.HtmlDefines.UPLOADED_ID_GIF;case s.TagId.MAP_UPLOADED:return t.HtmlDefines.UPLOADED_ID_MAP;case s.TagId.LOADING:return t.HtmlDefines.IS_LOADING;default:return""}},t.View=i},855:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TagId=void 0,t.TagId={MAP_UPLOADED:1,GIF_UPLOADED:2,LOADING:3}}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}!function(){const e=n(785),t=n(0),o=n(107),a=n(459),r=n(156),s=n(132),i=n(855),d=new a.default,I={mapInfo:void 0,imageInfo:void 0},l=new s.View,c=t=>{I.imageInfo=t.imageInfo,I.mapInfo=t.mapInfo,(async()=>{const{imageInfo:t,mapInfo:n}=I,o=void 0!==n,a=void 0!==t,r=o&&a;l.showIfNeeded(i.TagId.LOADING,!0),l.showIfNeeded(i.TagId.MAP_UPLOADED,o),l.showIfNeeded(i.TagId.GIF_UPLOADED,a),r&&(await(0,e.default)(50),await l.showMap(n)),l.showIfNeeded(i.TagId.LOADING,!1)})()};l.addEvents((async e=>{const t=await(0,o.loadImageUrlAsync)(e).catch((()=>{const e=d.resolveErrorMessage(r.ErrorCode.ImageLoadFailed);l.showError(e)}));t&&(l.showGif(t),c(Object.assign(Object.assign({},I),{imageInfo:await l.showGif(t)})))}),(async e=>{const n=await(0,t.loadMapInfoAsync)(e).catch((()=>{const e=d.resolveErrorMessage(r.ErrorCode.DataLoadFailed);l.showError(e)}));n&&c(Object.assign(Object.assign({},I),{mapInfo:n}))}))}()}();