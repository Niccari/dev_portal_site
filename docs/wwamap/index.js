!function(){"use strict";var e={312:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.IMAGE_UNIT_WIDTH_PX=void 0,t.IMAGE_UNIT_WIDTH_PX=40},785:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=async e=>new Promise((t=>{setTimeout((()=>{t()}),e)}))},870:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MapAttribute=void 0,t.MapAttribute={x:6,y:7}},74:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(e){this.loadAsync=async e=>{const t=await this.fileLoader.loadAsync(e,"");return"string"==typeof t?a.parseDataAsync(t):Promise.reject(new Error("Unsupported return type"))},this.fileLoader=e}}a.decode=e=>{let t="",a=0;for(let r=0;r<e.length-3;r+=1)if(e.charCodeAt(a)===e.charCodeAt(a+1)){const r=e.charCodeAt(a+2)+1;for(let o=0;o<r;o+=1)t+=e[a];a+=3}else t+=e[a],a+=1;return t},a.loadWord=e=>t=>e.charCodeAt(t)+256*e.charCodeAt(t+1),a.parseMapItem=(e,t,a)=>{const r=[];for(let o=0;o<t;o+=1){r[o]=[];for(let n=0;n<t;n+=1){const s=e+2*(n+o*t),i=s+t*t*2;r[o][n]={obj:a(i),bg:a(s)}}}return r},a.parseAttrs=(e,t,a,r)=>{const o=[];for(let n=0;n<a;n+=1){o[n]=[];for(let a=0;a<t;a+=1)o[n][a]=r(e+2*(a+n*t))}return o},a.validateSize=(e,t,a)=>e<=501||t<=200||a<=200,a.parseDataAsync=async e=>{const t=a.decode(e),r=a.loadWord(t),o=r(46),n=r(34),s=r(36);if(!a.validateSize(o,n,s))return Promise.reject(new Error("Invalid data size!"));const i=90+o*o*4,d=i+60*n*2,I=a.parseMapItem(90,o,r),l=a.parseAttrs(i,60,n,r),c=a.parseAttrs(d,60,s,r),_=Array.from(Array(12).keys()).map((e=>r(20+e)%256));return{check:r(0),version:r(2),hpInit:r(10),strInit:r(12),defInit:r(14),goldInit:r(16),items:_,hpMap:r(32),numBg:n,numObj:s,xInit:r(38),yInit:r(40),xGameover:r(42),yGameover:r(44),sizeMap:o,numMessage:r(48),map:I,bgAttrs:l,objAttrs:c}},t.default=a},800:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.loadAsync=(e,t)=>e.type!==t?Promise.reject(new Error("Invalid file type")):new Promise(((a,r)=>{const o=new FileReader;o.onload=e=>{var t;const o=null===(t=e.target)||void 0===t?void 0:t.result;o?a(o):r()},t.includes("image")?o.readAsDataURL(e):o.readAsBinaryString(e)}))}}},874:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.loadDataUrlAsync=async e=>{const t=await this.fileLoader.loadAsync(e,"image/gif");return"string"==typeof t?t:Promise.reject(new Error("Unsupported return type"))},this.fileLoader=e}}},459:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});const r=a(312),o=a(156);t.default=class{showGifInfo(e){const{width:t,height:a}=e;return[`横方向の画像数, 縦方向の画像数 = ${Math.floor(t/r.IMAGE_UNIT_WIDTH_PX)}, ${Math.floor(a/r.IMAGE_UNIT_WIDTH_PX)}`]}showMapInfo(e){return["マップバージョン:"+e.version/10,`HP:${e.hpInit}/${e.hpMap}`,`攻撃力:${e.strInit}`,`防御力:${e.defInit}`,`所持金:${e.goldInit}`,`所持アイテム番号:${e.items.map((e=>e.toString())).join(",")}`,`MAX HP:${e.hpMap}`,`背景パーツ 最大数:${e.numBg}`,`物体パーツ 最大数:${e.numObj}`,`初期位置(x, y): (${e.xInit}, ${e.yInit})`,`ゲームオーバー位置(x, y): (${e.xGameover}, ${e.yGameover})`,`マップサイズ(w, h):${e.sizeMap}x${e.sizeMap}`]}resolveErrorMessage(e){switch(e){case o.ErrorCode.DataLoadFailed:return"マップファイルを読み込めませんでした。WWAで使用しているマップファイルかご確認ください。";case o.ErrorCode.ImageLoadFailed:return"画像ファイルを読み込めませんでした。WWAで使用している画像ファイルかご確認ください。";default:return""}}}},156:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCode=void 0,t.ErrorCode={DataLoadFailed:1,ImageLoadFailed:2}},132:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.View=t.HtmlDefines=void 0;const r=a(312),o=a(785),n=a(870),s=a(855);t.HtmlDefines={UPLOADED_ID_GIF:"gif_uploaded",UPLOADED_ID_MAP:"dat_uploaded",INPUT_ID_GIF:"gif_file",INPUT_ID_MAP:"dat_file",GIF_SRC_PREVIEW:"gif_src_preview",IS_LOADING:"is_loading",ERROR_MESSAGE:"error_message",CANVAS_GIF_MAP_PREVIEW:"gif_map_preview"};class i{constructor(){this.addEvents=(e,a)=>{i.addFileEvent(t.HtmlDefines.INPUT_ID_GIF,e),i.addFileEvent(t.HtmlDefines.INPUT_ID_MAP,a)},this.showMap=async e=>{const a=i.fetchImageTag(),o=i.getCanvasById(t.HtmlDefines.CANVAS_GIF_MAP_PREVIEW);if(!a||!o)return;const s=o.getContext("2d",{alpha:!1});if(!s)return;const{sizeMap:d}=e;o.width=d*r.IMAGE_UNIT_WIDTH_PX,o.height=d*r.IMAGE_UNIT_WIDTH_PX;const{map:I}=e;for(let t=0;t<d;t+=1)for(let o=0;o<d;o+=1){const{bg:i}=I[t][o],{obj:d}=I[t][o],l=e.bgAttrs[i],c=e.objAttrs[d];if(l&&c){const e=l[n.MapAttribute.x],i=l[n.MapAttribute.y],d=c[n.MapAttribute.x],I=c[n.MapAttribute.y];s.drawImage(a,e,i,r.IMAGE_UNIT_WIDTH_PX,r.IMAGE_UNIT_WIDTH_PX,o*r.IMAGE_UNIT_WIDTH_PX,t*r.IMAGE_UNIT_WIDTH_PX,r.IMAGE_UNIT_WIDTH_PX,r.IMAGE_UNIT_WIDTH_PX),0===d&&0===I||s.drawImage(a,d,I,r.IMAGE_UNIT_WIDTH_PX,r.IMAGE_UNIT_WIDTH_PX,o*r.IMAGE_UNIT_WIDTH_PX,t*r.IMAGE_UNIT_WIDTH_PX,r.IMAGE_UNIT_WIDTH_PX,r.IMAGE_UNIT_WIDTH_PX)}}},this.showGif=async e=>new Promise(((t,a)=>{const r=i.fetchImageTag();r?(r.onload=()=>{t({width:r.width,height:r.height,dataUrl:e})},r.src=e):a()})),this.showIfNeeded=(e,t)=>{const a=i.resolveTag(e),r=document.getElementById(a);if(!r)return;r.style.display=t?"inline-block":"none"},this.showError=async e=>{const a=document.getElementById(t.HtmlDefines.ERROR_MESSAGE);a&&(a.style.display="block",a.innerHTML=e,await(0,o.default)(3e3),a.style.display="none")}}}t.View=i,i.addFileEvent=(e,t)=>{const a=document.getElementById(e);if(!a)return;const r=e=>{var a;const r=null===(a=e.target)||void 0===a?void 0:a.files;r&&t(r[0])};a.addEventListener("change",r),a.addEventListener("dragstart",r)},i.fetchImageTag=()=>document.getElementById(t.HtmlDefines.GIF_SRC_PREVIEW),i.getCanvasById=e=>document.getElementById(e)||null,i.resolveTag=e=>{switch(e){case s.TagId.GIF_UPLOADED:return t.HtmlDefines.UPLOADED_ID_GIF;case s.TagId.MAP_UPLOADED:return t.HtmlDefines.UPLOADED_ID_MAP;case s.TagId.LOADING:return t.HtmlDefines.IS_LOADING;default:return""}}},855:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TagId=void 0,t.TagId={MAP_UPLOADED:1,GIF_UPLOADED:2,LOADING:3}}},t={};function a(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,a),n.exports}!function(){const e=a(785),t=a(74),r=a(800),o=a(874),n=a(459),s=a(156),i=a(132),d=a(855),I=new r.default,l=new t.default(I),c=new o.default(I),_=new n.default,f={mapInfo:void 0,imageInfo:void 0},u=new i.View,A=t=>{f.imageInfo=t.imageInfo,f.mapInfo=t.mapInfo,(async()=>{const{imageInfo:t,mapInfo:a}=f,r=void 0!==a,o=void 0!==t,n=r&&o;u.showIfNeeded(d.TagId.LOADING,!0),u.showIfNeeded(d.TagId.MAP_UPLOADED,r),u.showIfNeeded(d.TagId.GIF_UPLOADED,o),n&&(await(0,e.default)(50),await u.showMap(a)),u.showIfNeeded(d.TagId.LOADING,!1)})()};u.addEvents((async e=>{const t=await c.loadDataUrlAsync(e).catch((()=>{const e=_.resolveErrorMessage(s.ErrorCode.ImageLoadFailed);u.showError(e)}));t&&(u.showGif(t),A(Object.assign(Object.assign({},f),{imageInfo:await u.showGif(t)})))}),(async e=>{const t=await l.loadAsync(e).catch((()=>{const e=_.resolveErrorMessage(s.ErrorCode.DataLoadFailed);u.showError(e)}));t&&A(Object.assign(Object.assign({},f),{mapInfo:t}))}))}()}();