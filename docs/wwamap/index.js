!function(){"use strict";var e={312:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.IMAGE_UNIT_WIDTH_PX=void 0,t.IMAGE_UNIT_WIDTH_PX=40},785:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=async e=>new Promise((t=>{setTimeout((()=>{t()}),e)}))},870:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MapAttribute=void 0,t.MapAttribute={x:6,y:7}},74:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(e){this.loadAsync=async e=>{const t=await this.fileLoader.loadAsync(e,"");return"string"==typeof t?a.parseDataAsync(t):Promise.reject(new Error("Unsupported return type"))},this.fileLoader=e}}a.decode=e=>{let t="",a=0;for(let o=0;o<e.length-3;o+=1)if(e.charCodeAt(a)===e.charCodeAt(a+1)){const o=e.charCodeAt(a+2)+1;for(let n=0;n<o;n+=1)t+=e[a];a+=3}else t+=e[a],a+=1;return t},a.loadWord=e=>t=>e.charCodeAt(t)+256*e.charCodeAt(t+1),a.parseMapItem=(e,t,a)=>{const o=[];for(let n=0;n<t;n+=1){o[n]=[];for(let r=0;r<t;r+=1){const s=e+2*(r+n*t),i=s+t*t*2;o[n][r]={obj:a(i),bg:a(s)}}}return o},a.parseAttrs=(e,t,a,o)=>{const n=[];for(let r=0;r<a;r+=1){n[r]=[];for(let a=0;a<t;a+=1)n[r][a]=o(e+2*(a+r*t))}return n},a.validateSize=(e,t,a)=>e<=501||t<=200||a<=200,a.parseDataAsync=async e=>{const t=a.decode(e),o=a.loadWord(t),n=o(46),r=o(34),s=o(36);if(!a.validateSize(n,r,s))return Promise.reject(new Error("Invalid data size!"));const i=90+n*n*4,d=i+60*r*2,I=a.parseMapItem(90,n,o),l=a.parseAttrs(i,60,r,o),_=a.parseAttrs(d,60,s,o),c=Array.from(Array(12).keys()).map((e=>o(20+e)%256));return{check:o(0),version:o(2),hpInit:o(10),strInit:o(12),defInit:o(14),goldInit:o(16),items:c,hpMap:o(32),numBg:r,numObj:s,xInit:o(38),yInit:o(40),xGameover:o(42),yGameover:o(44),sizeMap:n,numMessage:o(48),map:I,bgAttrs:l,objAttrs:_}},t.default=a},800:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.loadAsync=(e,t)=>e.type!==t?Promise.reject(new Error("Invalid file type")):new Promise(((a,o)=>{const n=new FileReader;n.onload=e=>{var t;const n=null===(t=e.target)||void 0===t?void 0:t.result;n?a(n):o()},t.includes("image")?n.readAsDataURL(e):n.readAsBinaryString(e)}))}}},874:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.loadDataUrlAsync=async e=>{const t=await this.fileLoader.loadAsync(e,"image/gif");return"string"==typeof t?t:Promise.reject(new Error("Unsupported return type"))},this.fileLoader=e}}},459:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});const o=a(312),n=a(156);t.default=class{showGifInfo(e){const{width:t,height:a}=e;return[`横方向の画像数, 縦方向の画像数 = ${Math.floor(t/o.IMAGE_UNIT_WIDTH_PX)}, ${Math.floor(a/o.IMAGE_UNIT_WIDTH_PX)}`]}showMapInfo(e){return["マップバージョン:"+e.version/10,`HP:${e.hpInit}/${e.hpMap}`,`攻撃力:${e.strInit}`,`防御力:${e.defInit}`,`所持金:${e.goldInit}`,`所持アイテム番号:${e.items.map((e=>e.toString())).join(",")}`,`MAX HP:${e.hpMap}`,`背景パーツ 最大数:${e.numBg}`,`物体パーツ 最大数:${e.numObj}`,`初期位置(x, y): (${e.xInit}, ${e.yInit})`,`ゲームオーバー位置(x, y): (${e.xGameover}, ${e.yGameover})`,`マップサイズ(w, h):${e.sizeMap}x${e.sizeMap}`]}resolveErrorMessage(e){switch(e){case n.ErrorCode.DataLoadFailed:return"マップファイルを読み込めませんでした。WWAで使用しているマップファイルかご確認ください。";case n.ErrorCode.ImageLoadFailed:return"画像ファイルを読み込めませんでした。WWAで使用している画像ファイルかご確認ください。";default:return""}}}},156:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCode=void 0,t.ErrorCode={DataLoadFailed:1,ImageLoadFailed:2}},132:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.View=t.HtmlDefines=void 0;const o=a(312),n=a(785),r=a(870),s=a(855);t.HtmlDefines={UPLOADED_ID_GIF:"gif_uploaded",UPLOADED_ID_MAP:"dat_uploaded",INPUT_ID_GIF:"gif_file",INPUT_ID_MAP:"dat_file",GIF_SRC_PREVIEW:"gif_src_preview",IS_LOADING:"is_loading",ERROR_MESSAGE:"error_message",CANVAS_GIF_MAP_PREVIEW:"gif_map_preview",GIF_MAP_DOWNLOAD:"gif_map_download",GIF_MAP_DOWNLOAD_BUTTON:"git_map_download_button"};class i{constructor(){this.addEvents=(e,a)=>{i.addFileEvent(t.HtmlDefines.INPUT_ID_GIF,e),i.addFileEvent(t.HtmlDefines.INPUT_ID_MAP,a)},this.showMap=async e=>{const a=i.fetchImageTag(),n=i.getCanvasById(t.HtmlDefines.CANVAS_GIF_MAP_PREVIEW);if(!a||!n)return;const s=n.getContext("2d");if(!s)return;const{sizeMap:d}=e;n.width=d*o.IMAGE_UNIT_WIDTH_PX,n.height=d*o.IMAGE_UNIT_WIDTH_PX;const{map:I}=e;for(let t=0;t<d;t+=1)for(let n=0;n<d;n+=1){const{bg:i}=I[t][n],{obj:d}=I[t][n],l=e.bgAttrs[i],_=e.objAttrs[d];if(l&&_){const e=l[r.MapAttribute.x],i=l[r.MapAttribute.y],d=_[r.MapAttribute.x],I=_[r.MapAttribute.y];s.drawImage(a,e,i,o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX,n*o.IMAGE_UNIT_WIDTH_PX,t*o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX),0===d&&0===I||s.drawImage(a,d,I,o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX,n*o.IMAGE_UNIT_WIDTH_PX,t*o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX,o.IMAGE_UNIT_WIDTH_PX)}}const l=document.getElementById(t.HtmlDefines.GIF_MAP_DOWNLOAD);l&&(l.href=n.toDataURL())},this.showGif=async e=>new Promise(((t,a)=>{const o=i.fetchImageTag();o?(o.onload=()=>{t({width:o.width,height:o.height,dataUrl:e})},o.src=e):a()})),this.enableDownloadButton=e=>{const a=document.getElementById(t.HtmlDefines.GIF_MAP_DOWNLOAD_BUTTON);a&&(a.disabled=!e)},this.showIfNeeded=(e,t)=>{const a=i.resolveTag(e),o=document.getElementById(a);if(!o)return;o.style.display=t?"inline-block":"none"},this.showError=async e=>{const a=document.getElementById(t.HtmlDefines.ERROR_MESSAGE);a&&(a.style.display="block",a.innerHTML=e,await(0,n.default)(3e3),a.style.display="none")}}}t.View=i,i.addFileEvent=(e,t)=>{const a=document.getElementById(e);if(!a)return;const o=e=>{var a;const o=null===(a=e.target)||void 0===a?void 0:a.files;o&&t(o[0])};a.addEventListener("change",o),a.addEventListener("dragstart",o)},i.fetchImageTag=()=>document.getElementById(t.HtmlDefines.GIF_SRC_PREVIEW),i.getCanvasById=e=>document.getElementById(e)||null,i.resolveTag=e=>{switch(e){case s.TagId.GIF_UPLOADED:return t.HtmlDefines.UPLOADED_ID_GIF;case s.TagId.MAP_UPLOADED:return t.HtmlDefines.UPLOADED_ID_MAP;case s.TagId.LOADING:return t.HtmlDefines.IS_LOADING;default:return""}}},855:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TagId=void 0,t.TagId={MAP_UPLOADED:1,GIF_UPLOADED:2,LOADING:3}}},t={};function a(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,a),r.exports}!function(){const e=a(785),t=a(74),o=a(800),n=a(874),r=a(459),s=a(156),i=a(132),d=a(855),I=new o.default,l=new t.default(I),_=new n.default(I),c=new r.default,f={mapInfo:void 0,imageInfo:void 0},u=new i.View,A=t=>{f.imageInfo=t.imageInfo,f.mapInfo=t.mapInfo,(async()=>{const{imageInfo:t,mapInfo:a}=f,o=void 0!==a,n=void 0!==t,r=o&&n;u.showIfNeeded(d.TagId.LOADING,!0),u.showIfNeeded(d.TagId.MAP_UPLOADED,o),u.showIfNeeded(d.TagId.GIF_UPLOADED,n),r&&(await(0,e.default)(50),await u.showMap(a)),u.showIfNeeded(d.TagId.LOADING,!1),u.enableDownloadButton(r)})()};u.addEvents((async e=>{const t=await _.loadDataUrlAsync(e).catch((()=>{const e=c.resolveErrorMessage(s.ErrorCode.ImageLoadFailed);u.showError(e)}));t&&(u.showGif(t),A(Object.assign(Object.assign({},f),{imageInfo:await u.showGif(t)})))}),(async e=>{const t=await l.loadAsync(e).catch((()=>{const e=c.resolveErrorMessage(s.ErrorCode.DataLoadFailed);u.showError(e)}));t&&A(Object.assign(Object.assign({},f),{mapInfo:t}))}))}()}();